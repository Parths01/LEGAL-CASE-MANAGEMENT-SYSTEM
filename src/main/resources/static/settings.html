<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Smart Legal CMS</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .page-card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); margin-bottom: 24px; }
        .settings-container { display: grid; grid-template-columns: 200px 1fr; gap: 24px; }
        .settings-menu { display: flex; flex-direction: column; gap: 8px; }
        .settings-menu button { padding: 12px 16px; text-align: left; border: none; background: #f5f5f5; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .settings-menu button.active { background: linear-gradient(135deg, #0b1c2d, #1a3a52); color: white; }
        .settings-menu button:hover { background: #e0e0e0; }
        .settings-menu button.active:hover { background: linear-gradient(135deg, #0b1c2d, #1a3a52); }
        .settings-section { display: none; }
        .settings-section.active { display: block; }
        .form-group { display: flex; flex-direction: column; margin-bottom: 16px; }
        .form-group label { font-weight: 600; margin-bottom: 6px; }
        .form-group input, .form-group select, .form-group textarea { padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
        .btn-save { background: linear-gradient(135deg, #0b1c2d, #1a3a52); color: white; padding: 10px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-save:hover { opacity: 0.9; }
        .btn-danger { background: #f44336; color: white; padding: 10px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-danger:hover { opacity: 0.9; }
        .toggle-switch { display: flex; align-items: center; gap: 10px; }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background: #ccc; transition: 0.3s; border-radius: 24px; }
        .slider::before { position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background: white; transition: 0.3s; border-radius: 50%; }
        input:checked+.slider { background: #2196f3; }
        input:checked+.slider::before { transform: translateX(26px); }
        .user-role-list { display: flex; flex-direction: column; gap: 12px; }
        .user-role-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f5f5f5; border-radius: 8px; }
        .role-badge { display: inline-block; padding: 4px 8px; background: #e3f2fd; color: #1976d2; border-radius: 4px; font-size: 0.85rem; font-weight: 600; }
        .success-msg { display: none; padding: 12px; background: #e8f5e9; color: #2e7d32; border-radius: 8px; margin-bottom: 16px; }
        @media (max-width: 768px) { .main-content { margin-left: 0; } .sidebar { transform: translateX(-100%); } .settings-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body class="dashboard-body">
    <div class="sidebar">
        <div class="sidebar-logo"><i class="fas fa-balance-scale"></i><h4>Legal CMS</h4></div>
        <ul class="sidebar-menu">
            <li><a href="admin-dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="cases.html"><i class="fas fa-folder-open"></i> Cases</a></li>
            <li><a href="advocates.html"><i class="fas fa-user-tie"></i> Advocates</a></li>
            <li><a href="clients.html"><i class="fas fa-users"></i> Clients</a></li>
            <li><a href="hearings.html"><i class="fas fa-gavel"></i> Hearings</a></li>
            <li><a href="documents.html"><i class="fas fa-file-alt"></i> Documents</a></li>
            <li><a href="invoices.html"><i class="fas fa-file-invoice-dollar"></i> Invoices</a></li>
            <li><a href="payments.html"><i class="fas fa-credit-card"></i> Payments</a></li>
            <li><a href="legal-notices.html"><i class="fas fa-envelope-open-text"></i> Legal Notices</a></li>
            <li><a href="reports.html"><i class="fas fa-chart-bar"></i> Reports</a></li>
            <li><a href="settings.html" class="active"><i class="fas fa-cog"></i> Settings</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <h1><i class="fas fa-cog"></i> Settings</h1>
            <div class="user-info">
                <div class="user-avatar">A</div>
                <div><strong id="userName">Admin</strong><br><small class="text-muted">Administrator</small></div>
                <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </div>

        <div class="page-card">
            <div class="settings-container">
                <div class="settings-menu">
                    <button class="active" onclick="showSection('general')"><i class="fas fa-sliders-h"></i> General</button>
                    <button onclick="showSection('email')"><i class="fas fa-envelope"></i> Email</button>
                    <button onclick="showSection('sms')"><i class="fas fa-sms"></i> SMS</button>
                    <button onclick="showSection('api')"><i class="fas fa-key"></i> API Keys</button>
                    <button onclick="showSection('backup')"><i class="fas fa-database"></i> Backup</button>
                    <button onclick="showSection('users')"><i class="fas fa-users-cog"></i> User Management</button>
                </div>

                <div>
                    <div id="successMsg" class="success-msg"><i class="fas fa-check-circle"></i> Settings saved successfully!</div>

                    <!-- General Settings -->
                    <div id="general" class="settings-section active">
                        <h2>General Settings</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Firm Name</label>
                                <input type="text" id="firmName" value="Legal Firm">
                            </div>
                            <div class="form-group">
                                <label>Firm Email</label>
                                <input type="email" id="firmEmail" value="contact@legalfirm.com">
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" id="firmPhone" value="+91-9876543210">
                            </div>
                            <div class="form-group">
                                <label>Office Address</label>
                                <input type="text" id="firmAddress" value="123 Legal Street, Delhi">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Terms & Conditions</label>
                            <textarea rows="4" id="termsText">Please accept our terms and conditions for using this service...</textarea>
                        </div>
                        <button class="btn-save" onclick="saveGeneralSettings()"><i class="fas fa-save"></i> Save Settings</button>
                    </div>

                    <!-- Email Settings -->
                    <div id="email" class="settings-section">
                        <h2>Email Configuration</h2>
                        <div class="form-group">
                            <label>SMTP Server</label>
                            <input type="text" placeholder="smtp.gmail.com" value="smtp.gmail.com">
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>SMTP Port</label>
                                <input type="number" placeholder="587" value="587">
                            </div>
                            <div class="form-group">
                                <label>SMTP Username</label>
                                <input type="email" placeholder="your-email@gmail.com">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>SMTP Password</label>
                            <input type="password" placeholder="••••••••">
                        </div>
                        <div class="form-group">
                            <label class="toggle-switch">
                                Enable Email Notifications
                                <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                            </label>
                        </div>
                        <button class="btn-save" onclick="saveEmailSettings()"><i class="fas fa-save"></i> Save Email Settings</button>
                    </div>

                    <!-- SMS Settings -->
                    <div id="sms" class="settings-section">
                        <h2>SMS Configuration</h2>
                        <div class="form-group">
                            <label>SMS Gateway Provider</label>
                            <select>
                                <option>Twilio</option>
                                <option>AWS SNS</option>
                                <option>Firebase</option>
                                <option>Custom Provider</option>
                            </select>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>API Key</label>
                                <input type="password" placeholder="••••••••">
                            </div>
                            <div class="form-group">
                                <label>API Secret</label>
                                <input type="password" placeholder="••••••••">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="toggle-switch">
                                Enable SMS Notifications
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                            </label>
                        </div>
                        <button class="btn-save" onclick="saveSmsSettings()"><i class="fas fa-save"></i> Save SMS Settings</button>
                    </div>

                    <!-- API Keys -->
                    <div id="api" class="settings-section">
                        <h2>API Key Management</h2>
                        <div class="form-group">
                            <label>Current API Key</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" value="sk_live_abc123def456..." readonly style="flex: 1;">
                                <button class="btn-save" style="background: #ff9800;" onclick="copyToClipboard('sk_live_abc123def456...')"><i class="fas fa-copy"></i> Copy</button>
                            </div>
                        </div>
                        <button class="btn-danger" onclick="regenerateApiKey()"><i class="fas fa-refresh"></i> Regenerate Key</button>
                        <p style="margin-top: 16px; color: #666; font-size: 0.9rem;"><i class="fas fa-info-circle"></i> Regenerating will invalidate the old key. Update your integrations accordingly.</p>
                    </div>

                    <!-- Backup & Maintenance -->
                    <div id="backup" class="settings-section">
                        <h2>Backup & Maintenance</h2>
                        <div class="form-group">
                            <label>Last Backup</label>
                            <p style="padding: 10px; background: #f5f5f5; border-radius: 8px;">2024-01-15 03:45:00 UTC</p>
                        </div>
                        <div class="form-group">
                            <label>Backup Frequency</label>
                            <select>
                                <option>Daily</option>
                                <option>Weekly</option>
                                <option>Monthly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="toggle-switch">
                                Enable Automatic Backups
                                <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                            </label>
                        </div>
                        <button class="btn-save" style="background: #4caf50;" onclick="createBackup()"><i class="fas fa-download"></i> Create Backup Now</button>
                        <button class="btn-danger" onclick="clearCache()"><i class="fas fa-trash"></i> Clear Cache</button>
                    </div>

                    <!-- User Management -->
                    <div id="users" class="settings-section">
                        <h2>User Management</h2>
                        <div class="form-group">
                            <label>User Roles</label>
                            <div class="user-role-list">
                                <div class="user-role-item">
                                    <div><strong>Administrator</strong><br><small style="color: #999;">Can manage all system settings and users</small></div>
                                    <span class="role-badge">ADMIN</span>
                                </div>
                                <div class="user-role-item">
                                    <div><strong>Advocate</strong><br><small style="color: #999;">Can manage assigned cases and documents</small></div>
                                    <span class="role-badge">ADVOCATE</span>
                                </div>
                                <div class="user-role-item">
                                    <div><strong>Client</strong><br><small style="color: #999;">Can view case status and documents</small></div>
                                    <span class="role-badge">CLIENT</span>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 24px;">
                            <h4>Active Users</h4>
                            <p id="activeUserCount" style="font-size: 1.5rem; font-weight: bold; color: #0b1c2d;">0</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const token = localStorage.getItem('token');
        if (!token) { window.location.href = 'login.html'; }

        document.addEventListener('DOMContentLoaded', () => {
            loadUserInfo();
            loadUserCount();
        });

        function loadUserInfo() {
            const u = localStorage.getItem('userName');
            if (u) document.getElementById('userName').textContent = u;
        }

        async function loadUserCount() {
            try {
                const res = await fetch('/api/users', { headers: { 'Authorization': `Bearer ${token}` } });
                if (res.ok) {
                    const users = await res.json();
                    document.getElementById('activeUserCount').textContent = users.length;
                }
            } catch (e) {
                console.error(e);
            }
        }

        function showSection(section) {
            document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.settings-menu button').forEach(b => b.classList.remove('active'));
            document.getElementById(section).classList.add('active');
            event.target.closest('button').classList.add('active');
        }

        function saveGeneralSettings() {
            const msg = document.getElementById('successMsg');
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }

        function saveEmailSettings() {
            const msg = document.getElementById('successMsg');
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }

        function saveSmsSettings() {
            const msg = document.getElementById('successMsg');
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }

        function regenerateApiKey() {
            if (confirm('This will invalidate your current API key. Continue?')) {
                alert('New API key generated: sk_live_' + Math.random().toString(36).substr(2, 20));
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => alert('Copied!'));
        }

        function createBackup() {
            alert('Backup created successfully!');
        }

        function clearCache() {
            if (confirm('Clear all cached data?')) {
                alert('Cache cleared!');
            }
        }

        function logout() { localStorage.clear(); window.location.href = 'login.html'; }
    </script>
</body>
</html>
