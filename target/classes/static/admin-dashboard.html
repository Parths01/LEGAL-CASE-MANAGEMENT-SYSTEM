<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Smart Legal CMS</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="dashboard-body">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-logo">
            <i class="fas fa-balance-scale"></i>
            <h4>Legal CMS</h4>
        </div>
        <ul class="sidebar-menu">
            <li><a href="admin-dashboard.html" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="cases.html"><i class="fas fa-folder-open"></i> Cases</a></li>
            <li><a href="advocates.html"><i class="fas fa-user-tie"></i> Advocates</a></li>
            <li><a href="clients.html"><i class="fas fa-users"></i> Clients</a></li>
            <li><a href="hearings.html"><i class="fas fa-gavel"></i> Hearings</a></li>
            <li><a href="documents.html"><i class="fas fa-file-alt"></i> Documents</a></li>
            <li><a href="invoices.html"><i class="fas fa-file-invoice-dollar"></i> Invoices</a></li>
            <li><a href="payments.html"><i class="fas fa-credit-card"></i> Payments</a></li>
            <li><a href="legal-notices.html"><i class="fas fa-envelope-open-text"></i> Legal Notices</a></li>
            <li><a href="reports.html"><i class="fas fa-chart-bar"></i> Reports</a></li>
            <li><a href="settings.html"><i class="fas fa-cog"></i> Settings</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
            <div class="user-info">
                <div class="user-avatar">A</div>
                <div>
                    <strong id="userName">Admin</strong><br>
                    <small class="text-muted">Administrator</small>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row">
            <div class="col-md-3 mb-4">
                <div class="dashboard-card">
                    <div class="card-icon blue">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    <div class="stat-number" id="totalCases">0</div>
                    <div class="stat-label">Total Cases</div>
                    <a href="cases.html" class="card-footer-link">View All <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="dashboard-card">
                    <div class="card-icon green">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="stat-number" id="totalAdvocates">0</div>
                    <div class="stat-label">Advocates</div>
                    <a href="advocates.html" class="card-footer-link">View All <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="dashboard-card">
                    <div class="card-icon purple">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-number" id="totalClients">0</div>
                    <div class="stat-label">Clients</div>
                    <a href="clients.html" class="card-footer-link">View All <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="dashboard-card">
                    <div class="card-icon orange">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <div class="stat-number" id="pendingHearings">0</div>
                    <div class="stat-label">Pending Hearings</div>
                    <a href="hearings.html" class="card-footer-link">View All <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
        </div>

        <!-- Revenue Cards -->
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="dashboard-card">
                    <h5><i class="fas fa-dollar-sign"></i> Total Revenue</h5>
                    <div class="stat-number text-success" id="totalRevenue">₹0</div>
                    <small class="text-muted">From paid invoices</small>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="dashboard-card">
                    <h5><i class="fas fa-clock"></i> Pending Revenue</h5>
                    <div class="stat-number text-warning" id="pendingRevenue">₹0</div>
                    <small class="text-muted">From pending invoices</small>
                </div>
            </div>
        </div>

        <!-- Recent Cases Table -->
        <div class="data-table">
            <div class="table-header">
                <h3><i class="fas fa-folder-open"></i> Recent Cases</h3>
                <button class="btn-add" onclick="window.location.href='add-case.html'">
                    <i class="fas fa-plus"></i> Add New Case
                </button>
            </div>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Case Number</th>
                            <th>Title</th>
                            <th>Client</th>
                            <th>Advocate</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="casesTableBody">
                        <tr>
                            <td colspan="6" class="text-center">Loading cases...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="chart-container">
                    <h5><i class="fas fa-chart-bar"></i> Case Status Distribution</h5>
                    <canvas id="caseStatusChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h5><i class="fas fa-chart-line"></i> Monthly Revenue</h5>
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Check authentication
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'login.html';
        }

        // Set user name
        document.getElementById('userName').textContent = localStorage.getItem('userName') || 'Admin';

        // Logout function
        function logout() {
            localStorage.clear();
            window.location.href = 'login.html';
        }

        // Load dashboard stats
        async function loadDashboardStats() {
            try {
                const response = await fetch('http://localhost:8080/api/dashboard/admin/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const stats = data.data;

                    document.getElementById('totalCases').textContent = stats.totalCases || 0;
                    document.getElementById('totalAdvocates').textContent = stats.totalAdvocates || 0;
                    document.getElementById('totalClients').textContent = stats.totalClients || 0;
                    document.getElementById('pendingHearings').textContent = stats.pendingHearings || 0;
                    document.getElementById('totalRevenue').textContent = `₹${(stats.totalRevenue || 0).toLocaleString()}`;
                    document.getElementById('pendingRevenue').textContent = `₹${(stats.pendingRevenue || 0).toLocaleString()}`;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Initialize charts
        function initializeCharts() {
            // Case Status Chart
            const ctx1 = document.getElementById('caseStatusChart').getContext('2d');
            new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Open', 'In Progress', 'Closed', 'Won', 'Lost'],
                    datasets: [{
                        data: [12, 19, 15, 8, 3],
                        backgroundColor: ['#4facfe', '#43e97b', '#fa709a', '#f093fb', '#c4991f']
                    }]
                }
            });

            // Revenue Chart
            const ctx2 = document.getElementById('revenueChart').getContext('2d');
            new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue (₹)',
                        data: [65000, 75000, 82000, 91000, 88000, 95000],
                        borderColor: '#d4af37',
                        backgroundColor: 'rgba(212, 175, 55, 0.1)',
                        tension: 0.4
                    }]
                }
            });
        }

        // Load on page load
        window.onload = function() {
            loadDashboardStats();
            initializeCharts();
        };
    </script>
</body>
</html>
